## 10. Virtual Memory
#OS #virtual_memory

작성일자: 2025.03.19. (Wed)

### Q. Virtual Memory 대해 설명해 주세요.

가상 메모리(virtual memory)란 process 전체가 메모리에 올라오지 않더라도 실행이 가능하도록 하는 기법이다. 가상 메모리 기법을 통해 사용자 프로그램이 물리적 메모리보다 커져도 실행이 가능하게 된다.

#### TIP
운영체제에서 메모리 관련 면접문제는 이 안에서 다 나온다!! 
실제 우리가 사용하고 있는 운영체제는 가상메모리를 사용하고 있어서 개발자라면 필수로 알아야한다.
- 운영체제에 의해 메모리가 어떻게 관리되는가
- 가상메모리는 무엇인가
- page fault는 무엇이고 page 교체 알고지늠에는 어떤 것들이 있는가

### 가상메모리 (Virtual Memory)

가상메모리는 실제 물리 메모리 개념과 개발자 입장의 논리 메모리 개념을 분리한 것이다. 이렇게 분리함으로서 개발자가 메모리 크기에 관련한 문제를 염려할 필요 없이 쉽게 프로그램을 작성할 수 있다.

운영체제는 가상 메모리 기법을 통해 프로그램의 논리적 주소 영역에서 필요한 부분만 물리적 메모리에 적재하고, 직접적으로 필요하지 않은 메모리 공간은 디스크(Swap 영역)에 저장하게 된다.


#### 요구 페이징(demand paging)

당장 사용될 주소 공간을 page 단위로 메모리에 적재하는 방법을 요구 페이징이라고 한다. 이 기법에서는 특정 page에 대해 **cpu의 요청이 들어온 후에** 해당 page를 메모리에 적재한다. 당장 실행에 필요한 page만을 적재하기에 메모리 사용량이 감소하고 프로세스 전체를 메모리에 적재하는 입출력 오버헤드도 감소하는 장점이 있다.

요구 페이징 기법에서는 유효/무효 비트(valid/invalid bit)를 두어 각 page가 메모리에 존재하는지 표시한다.


#### Page Fault
CPU가 무표 비트(invalid bit)로 표시된 page에 엑세스 하는 상황을 page fault라고 한다.
이 때, 주소 변환을 담당하는 하드웨어인 MMU가 page fault trap을 발생시키게 되고, 다음 순서로 page fault를 처리한다.
1. CPU가 페이지 N을 참조한다.
2. Page table에서 페이지 N이 무효상태임을 확인한다.
3. MMU에서 page fault trap이 발생한다.
4. 디스크에서 페이지 N을 빈 프레임에 적재하고 page table을 업데이트한다. (invalid -> valid)

MMU(Memory Management Unit): 가상 주소를 물리 메모리 주소로 변환해주는 하드웨어 장치

#### page 교체 알고리즘 (replacement algorithm)
page fault가 발생되면 요청된 page를 디스크에서 메모리로 가져온다. 이 때, 물리적 공간이 부족할 경우 메모리에 올라와 있는 page를 디스크로 옮겨서 메모리 공간을 확보해야한다. 이를 페이지 교체라고 하고, 어떤 page를 교체할 것이냐를 경정하는 알고리즘이 page 교체 알고리즘 이다/

최대한 page fault가 적게 일어나도록 해야 하기에 앞으로 참조될 가능성이 적은 page를 선택해서 교체하는 것이 성능을 향상시키는 방법이다.

| 알고리즘                       | 설명                                                     |
| -------------------------- | ------------------------------------------------------ |
| FIFO(First In First Out)   | 메모리에 올라온지 가장 오래된 page를 교체한다                            |
| 최적 페이지 교체                  | 앞으로 가장 오랫동안 사용되지 않을 page를 찾아 교체한다. <br>=> 실제구현은 어렵다    |
| LRU(Least Recently Used)   | 가장 오랫동안 사용되지 않은 page를 교체한다                             |
| LFU(Least Frequently Used) | 참조 횟수가 가장 적은 page를 교체한다. <br>비용대비 성능이 좋지 않아 잘 쓰이지 않는다. |

### 꼬리질문

#꼬리Q **Q. 요구페이징(demand paging)이란 무엇인가요?**

#꼬리Q **Q. 페이지 교제 알고리즘에 대해 말씀해주세요.

#꼬리Q **Q. LRU 알고리즘과 LFU 알고리즘을 비교하여 설명해주세요.
