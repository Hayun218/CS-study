## 4. Multi-Process Data

작성일자: 2024.07.15



Q. 멀티 프로세스 환경에서 프로세스 간에 데이터 공유는 어떻게 이루어 지는가?



원칙적으로 process는 독립적인 주소 공간을 갖기 때문에 다른 process의 주소 공간을 참조할 수 없다. 하지만 경우에 따라 운영체제는 process 간 자원 접근을 위한 매커니즘인 프로세스 간 통신(IPC, Inter Process Communication)을 제공한다.

프로세스 간 통신(IPC) 방법으로는 파이프, 파일, 소켓, 공유메모리 등이 있다.



#### TIP

- multi thread와 다르게 process끼리는 데이터 공유 X => IPC 기법 사용

- IPC 방식은 크게 1)공유 메모리방식과 2)메세지 전달방식으로 나뉨
  - 둘의 장단점과 차이점을 중심으로 공부




### IPC (Inter-Process Communication)

프로세스는 각자 독립적인 주소공간을 지니며, 이를 다른 프로세스가 참조하는 것을 허용하지 않는다. 그렇기 때문에 다른 프로세스와 데이터를 주고받을 수 없다. 이를 해결하고자 운영체제는 IPC 기법을 통해 프로세스들 간 통신을 가능하게 한다.

프로세스간 통신(IPC)에는 기본적으로 공유메모리(shared memory)와 메시지 전달(message passing)의 두 가지 모델이 있다.



#### 공유메모리 (shared memory)

공유 메모리 방식에서 process들이 주소 공간의 일부를 공유한다. 공유한 메모리 영역에 읽기/쓰기를 통해 통신을 수행할 수 있다. process가 공유 메모리 할당을 kernel에 요청하면 kernel은 해당 process에 메모리 공간을 할당한다. 공유 메모리 영역이 구축된 후 모든 접근이 일반적인 메모리 접근으로 취급되기 때문에 kernel의 도움없이 각 process들이 해당 메모리 영역에 접근할 수 있다. 따라서 kernel의 관여 없이 데이터를 통신할 수 있기 때문에 **IPC 속도가 빠르다**.

공유 메모리 방식은 process간 수월한 통신을 위해 사용되지만 동일한 메모리 위치에 접근하게 되면 **일관성 문제**가 발생할 수 있다. 이에 대해 커널이 관여하지 않기에 process들끼리 직접 공유 메모리 접근에 대한 동기화 문제를 책임져야 한다.



process의 메모리 구조: code => shared memory => data => heap = > stack



#### 메시지 전달 (message passing)

메시지 전달 방법은 통상 system call을 사용해 구현된다. kernel을 통해 send(message)와 receive(message)라는 두가지 연산을 제공받는다. 예를 들어 process1이 kernel로 message를 보내면 kernel이 process2에게 해당 message를 전달하는 방식이다.

메모리 공유보다 속도가 느리지만 **충돌을 회피할 필요가 없기**에 적은양의 데이터를 교환하는 유용하며 구현하기가 쉽다.

대표적으로 pipe, socker, message queue등이 있다.



### 꼬리질문

Q. IPC의 예시를 들어줄 수 있나요?

IPC는 크게 공유 메모리 모델과 메시지 전달 모델로 나눌 수 있다. 공유 메모리 모델은 주소 공간의 일부를 공유하며 공유한 메모리 영역에 read/write를 통해 통신하게 된다. 예시로는 공유메모리와 POSIX가 있다. 메시지 전송 모델의 경우 kernel을 통해 send/receive 연산을 이루며 데이터를 전송한다. 예시로 pipe, socket, message queue 등이 있다.



Q. 공유메모리와 메시지 전달 모델의 장단점은?

[공유 메모리]

장점: 공유 메모리 할당을 제외하면 Kernel의 관여 없이 통신할 수 있기에 속도가 빠르다.
단점: 여러 프로세스가 동시에 메모리에 접근하는 문제가 발생할 수 있어 별도의 동기화 과정이 필요하다.

[메시지 전달]

장점: kernel에서 제어하기 때문에 안전하며 kernel이 동기화를 제공한다.
단점: kernel을 통해 데이터를 주고받기에 통신 속도가 느리다.
